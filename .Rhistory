fit.v %>%
kable() %>%
kable_styling(full_width = F)
fit.v %>%
kable() %>%
kable_styling(full_width = FALSE)
fit.v
fit.v %>%
select(mode, psill, range, kappa) %>%
kable() %>%
kable_styling(full_width = FALSE)
fit.v %>%
select(model, psill, range, kappa) %>%
kable() %>%
kable_styling(full_width = FALSE)
my_vario <- variogram(cl2_total ~ median_income, sites_sub)
fit.v <- fit.variogram(object = my_vario,
model = vgm(model = "Mat", psill = 0.10, range = 3000, nugget = 0.25))
fit.v %>%
select(model, psill, range, kappa) %>%
kable() %>%
kable_styling(full_width = FALSE)
fit.k <- krige(formula = cl2_total ~ median_income, locations = sites_sub,
newdata = sd_grid, model = fit.v)
fit.k <- krige(formula = cl2_total ~ median_income, locations = sites_sub,
newdata = sd_grid, model = fit.v)
RColorBrewer::brewer.pal(9, "YlOrRd")
image(fit.k, col = RColorBrewer::brewer.pal(9, "YlOrRd"), main = "prediction")
fit.k
fit.k %>% class
predict(fit.k)
predict(fit.k, sd_grid)
fit.k <- krige(formula = cl2_total ~ median_income, locations = sd_grid,
newdata = sites_sub, model = fit.v)
fit.k <- krige(formula = cl2_total ~ median_income, locations = sites_sub,
newdata = sd_grid, model = fit.v)
as.matrix(fit.j)
as.matrix(fit.k)
fit.k@data
image(fit.k, col = RColorBrewer::brewer.pal(9, "YlOrRd"), main = "prediction")
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(sp)
library(ggmap)
library(tidyverse)
library(magrittr)
library(gstat)
library(knitr)
library(kableExtra)
setwd(here::here())
load("data/city_boundary.RData") #loads sd_city variable
water_testing <- read.csv("data/indicator_bacteria_tests_datasd_v1.csv")
sites_ll <- read.csv("data/sample_sites_datasd_v1.csv")
load("data/sd_tracts_income.RData")
load("data/sd_grid.RData")
# prepare data
coordinates(sites_ll) <- c("lng", "lat")
proj4string(sites_ll) <- CRS("+proj=longlat")
sites <- spTransform(sites_ll, proj4string(sd_city))
proj4string(sd_city)
sites <- spTransform(sites, CRS("+proj=longlat"))
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.55,
right = -116.9, top = 33.05))
ggmap(map_stamen) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites))
sites$cl2_total <- sapply(as.character(sites_ll$site_ID), function(site){
median(water_testing$cl2_total[water_testing$source == site], na.rm = T)
})
sites_sub <- sites[!is.na(sites$cl2_total),]
sd_tracts@proj4string
sites_sub %<>% spTransform(., proj4string(sd_tracts))
sites_sub_new <- over(sites_sub, sd_tracts)
sites_sub@data %<>%
cbind(median_income = sites_sub_new$median_income)
sites_sub$median_income %>% head
fit.lm <- lm(cl2_total ~ median_income, sites_sub)
tidy.lm <- broom::tidy(fit.lm)
confint.lm <- confint(fit.lm)
cbind(tidy.lm, confint.lm) %>%
kable(row.names = FALSE) %>%
kable_styling(full_width = FALSE)
my_vario <- variogram(cl2_total ~ median_income, sites_sub)
fit.v <- fit.variogram(object = my_vario,
model = vgm(model = "Mat", psill = 0.10, range = 3000, nugget = 0.25))
fit.v %>%
select(model, psill, range, kappa) %>%
kable() %>%
kable_styling(full_width = FALSE)
fit.k <- krige(formula = cl2_total ~ median_income, locations = sites_sub,
newdata = sd_grid, model = fit.v)
head(fit.k)
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
imageScale(z = fit.k$var1.pred, col = RColorBrewer::brewer.pal(9, "YlOrRd"))
image(fit.k['var1.var'], col = RCol`orBrewer::brewer.pal(9, "YlGn"), main = "variance")
image(fit.k['var1.var'], col = RColorBrewer::brewer.pal(9, "YlGn"), main = "variance")
image(fit.k['var1.var'], col = RColorBrewer::brewer.pal(9, "YlGn"), main = "variance")
)
RColorBrewer::brewer.pal(9, "YlGn")
image(fit.k$var1.pred, col = RColorBrewer::brewer.pal(9, "YlGn"), main = "variance")
fit.k$var1.pred
image(z = fit.k$var1.pred, col = RColorBrewer::brewer.pal(9, "YlGn"), main = "variance")
imageScale(z = fit.k$var1.pred, col = RColorBrewer::brewer.pal(9, "YlOrRd"))
RColorBrewer::brewer.pal(9, "YlGn")
image(z = fit.k$var1.pred, col = RColorBrewer::brewer.pal(9, "YlGn"), main = "variance")
imageScale(z = fit.k$var1.var, col = RColorBrewer::brewer.pal(9, "YlGn"))
points(meuse, pch = 16, cex = 0.7)
points(sites_sub, pch = 16, cex = 0.7)
fit.k['var1.var']
fit.k['var1.var']
image(fit.k["var1.pred"], col = RColorBrewer::brewer.pal(9, "YlGn"), main = "variance")
image(fit.k['var1.pred'], col = RColorBrewer::brewer.pal(9, "YlGn"), main = "variance")
sites <- spTransform(sites, CRS("+proj=longlat"))
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.55,
right = -116.9, top = 33.05))
ggmap(map_stamen) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites))
fit.k2 <- spTransform(fit.k, CRS("+proj=longlat"))
fit.k$var1.pred
fit.k2
ggmap(map_stamen, extent = "device")
ggmap(map_stamen)
head(as.data.frame(fit.k2))
fit.k2 <- spTransform(fit.k, CRS("+proj=longlat")) %>% as.data.frame()
head(fit.k2)
fit.k_ll <- spTransform(fit.k, CRS("+proj=longlat")) %>% as.data.frame()
ggmap(map_stamen) +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll)
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll)
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = x1, y = x2), size = 0.7, data = as.data.frame(sites))
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = x1, y = x2), size = 0.7, data = as.data.frame(sites_sub))
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub))
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
fit.k_ll <- spTransform(fit.k, CRS("+proj=longlat")) %>% as.data.frame()
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
sites <- spTransform(sites, CRS("+proj=longlat"))
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.55,
right = -116.9, top = 34.05))
ggmap(map_stamen) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites))
sites <- spTransform(sites, CRS("+proj=longlat"))
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.55,
right = -116.9, top = 33.15))
ggmap(map_stamen) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites))
sites <- spTransform(sites, CRS("+proj=longlat"))
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.55,
right = -116.9, top = 33.35))
ggmap(map_stamen) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites))
sites <- spTransform(sites, CRS("+proj=longlat"))
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.55,
right = -116.9, top = 33.1))
ggmap(map_stamen) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites))
sites <- spTransform(sites, CRS("+proj=longlat"))
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.55,
right = -116.9, top = 33.0.5))
sites <- spTransform(sites, CRS("+proj=longlat"))
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.55,
right = -116.9, top = 33.0.))
sites <- spTransform(sites, CRS("+proj=longlat"))
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.55,
right = -116.9, top = 33.05))
ggmap(map_stamen) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites))
fit.k_ll <- spTransform(fit.k, CRS("+proj=longlat")) %>% as.data.frame()
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
fit.k_ll <- spTransform(fit.k, CRS("+proj=longlat")) %>% as.data.frame()
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
fit.k_ll <- spTransform(fit.k, CRS("+proj=longlat")) %>% as.data.frame()
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.55,
right = -116.9, top = 33.25))
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
fit.k_ll <- spTransform(fit.k, CRS("+proj=longlat")) %>% as.data.frame()
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.65,
right = -116.9, top = 33.25))
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
fit.k_ll <- spTransform(fit.k, CRS("+proj=longlat")) %>% as.data.frame()
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.45,
right = -116.9, top = 33.25))
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
fit.k_ll <- spTransform(fit.k, CRS("+proj=longlat")) %>% as.data.frame()
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.45,
right = -115.9, top = 33.25))
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
fit.k_ll <- spTransform(fit.k, CRS("+proj=longlat")) %>% as.data.frame()
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.45,
right = -116.7, top = 33.25))
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
fit.k_ll <- spTransform(fit.k, CRS("+proj=longlat")) %>% as.data.frame()
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.45,
right = -116.8, top = 33.25))
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
fit.k_ll <- spTransform(fit.k, CRS("+proj=longlat")) %>% as.data.frame()
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.45,
right = -116.8, top = 33.20))
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
fit.k_ll <- spTransform(fit.k, CRS("+proj=longlat")) %>% as.data.frame()
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.50,
right = -116.8, top = 33.20))
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
fit.k_ll <- spTransform(fit.k, CRS("+proj=longlat")) %>% as.data.frame()
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.50,
right = -116.85, top = 33.20))
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
fit.k_ll <- spTransform(fit.k, CRS("+proj=longlat")) %>% as.data.frame()
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.50,
right = -116.85, top = 33.20))
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll)
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub))
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd")
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
fit.k_ll <- spTransform(fit.k, CRS("+proj=longlat")) %>% as.data.frame()
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.50,
right = -116.85, top = 33.20))
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1) +
labs(x = "hh",
y = "dd")
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
# geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
ggmap(map_stamen, extent = "device") +
# geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
as.data.frame(sites_sub)
sites_sub %<>% spTransform(., CRS("+proj=longlat"))
sites_sub %<>% spTransform(., CRS("+proj=longlat")) %>% as.data.frame()
head(sites_sub)
fit.k_ll %<>%
spTransform(CRS("+proj=longlat")) %>% as.data.frame()
fit.k_ll %<>%
spTransform(., CRS("+proj=longlat")) %>% as.data.frame()
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(sp)
library(ggmap)
library(tidyverse)
library(magrittr)
library(gstat)
library(knitr)
library(kableExtra)
setwd(here::here())
load("data/city_boundary.RData") #loads sd_city variable
water_testing <- read.csv("data/indicator_bacteria_tests_datasd_v1.csv")
sites_ll <- read.csv("data/sample_sites_datasd_v1.csv")
load("data/sd_tracts_income.RData")
load("data/sd_grid.RData")
# prepare data
coordinates(sites_ll) <- c("lng", "lat")
proj4string(sites_ll) <- CRS("+proj=longlat")
sites <- spTransform(sites_ll, proj4string(sd_city))
proj4string(sd_city)
sites <- spTransform(sites, CRS("+proj=longlat"))
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.55,
right = -116.9, top = 33.05))
ggmap(map_stamen) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites))
sites$cl2_total <- sapply(as.character(sites_ll$site_ID), function(site){
median(water_testing$cl2_total[water_testing$source == site], na.rm = T)
})
sites_sub <- sites[!is.na(sites$cl2_total),]
sd_tracts@proj4string
sites_sub %<>% spTransform(., proj4string(sd_tracts))
sites_sub_new <- over(sites_sub, sd_tracts)
sites_sub@data %<>%
cbind(median_income = sites_sub_new$median_income)
sites_sub$median_income %>% head
fit.lm <- lm(cl2_total ~ median_income, sites_sub)
tidy.lm <- broom::tidy(fit.lm)
confint.lm <- confint(fit.lm)
cbind(tidy.lm, confint.lm) %>%
kable(row.names = FALSE) %>%
kable_styling(full_width = FALSE)
my_vario <- variogram(cl2_total ~ median_income, sites_sub)
fit.v <- fit.variogram(object = my_vario,
model = vgm(model = "Mat", psill = 0.10, range = 3000, nugget = 0.25))
fit.v %>%
select(model, psill, range, kappa) %>%
kable() %>%
kable_styling(full_width = FALSE)
fit.k <- krige(formula = cl2_total ~ median_income, locations = sites_sub,
newdata = sd_grid, model = fit.v)
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(sp)
library(ggmap)
library(tidyverse)
library(magrittr)
library(gstat)
library(knitr)
library(kableExtra)
setwd(here::here())
load("data/city_boundary.RData") #loads sd_city variable
water_testing <- read.csv("data/indicator_bacteria_tests_datasd_v1.csv")
sites_ll <- read.csv("data/sample_sites_datasd_v1.csv")
load("data/sd_tracts_income.RData")
load("data/sd_grid.RData")
# prepare data
coordinates(sites_ll) <- c("lng", "lat")
proj4string(sites_ll) <- CRS("+proj=longlat")
sites <- spTransform(sites_ll, proj4string(sd_city))
proj4string(sd_city)
sites <- spTransform(sites, CRS("+proj=longlat"))
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.55,
right = -116.9, top = 33.05))
ggmap(map_stamen) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites))
sites$cl2_total <- sapply(as.character(sites_ll$site_ID), function(site){
median(water_testing$cl2_total[water_testing$source == site], na.rm = T)
})
sites_sub <- sites[!is.na(sites$cl2_total),]
sd_tracts@proj4string
sites_sub %<>% spTransform(., proj4string(sd_tracts))
sites_sub_new <- over(sites_sub, sd_tracts)
sites_sub@data %<>%
cbind(median_income = sites_sub_new$median_income)
sites_sub$median_income %>% head
fit.lm <- lm(cl2_total ~ median_income, sites_sub)
tidy.lm <- broom::tidy(fit.lm)
confint.lm <- confint(fit.lm)
cbind(tidy.lm, confint.lm) %>%
kable(row.names = FALSE) %>%
kable_styling(full_width = FALSE)
my_vario <- variogram(cl2_total ~ median_income, sites_sub)
fit.v <- fit.variogram(object = my_vario,
model = vgm(model = "Mat", psill = 0.10, range = 3000, nugget = 0.25))
fit.v %>%
select(model, psill, range, kappa) %>%
kable() %>%
kable_styling(full_width = FALSE)
fit.k <- krige(formula = cl2_total ~ median_income, locations = sites_sub,
newdata = sd_grid, model = fit.v)
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
fit.k_ll %<>%
spTransform(., CRS("+proj=longlat")) %>% as.data.frame()
fit.k_ll <- fit.k %>%
spTransform(., CRS("+proj=longlat")) %>% as.data.frame()
sites_sub %<>% spTransform(., CRS("+proj=longlat")) %>% as.data.frame()
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.50,
right = -116.85, top = 33.20))
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
fit.k_ll <- fit.k %>%
spTransform(., CRS("+proj=longlat")) %>% as.data.frame()
sites_sub %<>% spTransform(., CRS("+proj=longlat")) %>% as.data.frame()
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
fit.k_ll
fit.k_ll <- fit.k %>%
spTransform(., CRS("+proj=longlat")) %>% as.data.frame()
sites_sub %<>% spTransform(., CRS("+proj=longlat")) %>% as.data.frame()
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(sp)
library(ggmap)
library(tidyverse)
library(magrittr)
library(gstat)
library(knitr)
library(kableExtra)
setwd(here::here())
load("data/city_boundary.RData") #loads sd_city variable
water_testing <- read.csv("data/indicator_bacteria_tests_datasd_v1.csv")
sites_ll <- read.csv("data/sample_sites_datasd_v1.csv")
load("data/sd_tracts_income.RData")
load("data/sd_grid.RData")
# prepare data
coordinates(sites_ll) <- c("lng", "lat")
proj4string(sites_ll) <- CRS("+proj=longlat")
sites <- spTransform(sites_ll, proj4string(sd_city))
proj4string(sd_city)
sites <- spTransform(sites, CRS("+proj=longlat"))
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.55,
right = -116.9, top = 33.05))
ggmap(map_stamen) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites))
sites$cl2_total <- sapply(as.character(sites_ll$site_ID), function(site){
median(water_testing$cl2_total[water_testing$source == site], na.rm = T)
})
sites_sub <- sites[!is.na(sites$cl2_total),]
sd_tracts@proj4string
sites_sub %<>% spTransform(., proj4string(sd_tracts))
sites_sub_new <- over(sites_sub, sd_tracts)
sites_sub@data %<>%
cbind(median_income = sites_sub_new$median_income)
sites_sub$median_income %>% head
fit.lm <- lm(cl2_total ~ median_income, sites_sub)
tidy.lm <- broom::tidy(fit.lm)
confint.lm <- confint(fit.lm)
cbind(tidy.lm, confint.lm) %>%
kable(row.names = FALSE) %>%
kable_styling(full_width = FALSE)
my_vario <- variogram(cl2_total ~ median_income, sites_sub)
fit.v <- fit.variogram(object = my_vario,
model = vgm(model = "Mat", psill = 0.10, range = 3000, nugget = 0.25))
fit.v %>%
select(model, psill, range, kappa) %>%
kable() %>%
kable_styling(full_width = FALSE)
fit.k <- krige(formula = cl2_total ~ median_income, locations = sites_sub,
newdata = sd_grid, model = fit.v)
fit.k_ll <- fit.k %>%
spTransform(., CRS("+proj=longlat")) %>% as.data.frame()
sites_sub %<>% spTransform(., CRS("+proj=longlat")) %>% as.data.frame()
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.50,
right = -116.85, top = 33.20))
ggmap(map_stamen, extent = "device") +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
ggmap(map_stamen) +
geom_point(aes(x = x1, y = x2, col = var1.pred), fit.k_ll) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites_sub)) +
scale_color_distiller(palette = "YlOrRd", direction = 1)
install.packages("tlmgr.pl")
rmarkdown::render("R/kristine-dinh-continuous-spatial-index.Rmd", output_format = "pdf_document")
setwd("R")
rmarkdown::render("kristine-dinh-continuous-spatial-index.Rmd", output_format = "pdf_document")
sd_city@proj4string
```{r fig.height=3}
sites <- spTransform(sites, CRS("+proj=longlat"))
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.55,
right = -116.9, top = 33.05))
ggmap(map_stamen) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites))
sites <- spTransform(sites, CRS("+proj=longlat"))
map_stamen <- get_stamenmap(bbox = c(left = -117.3, bottom = 32.55,
right = -116.9, top = 33.05))
ggmap(map_stamen) +
geom_point(aes(x = lng, y = lat), data = as.data.frame(sites))
library(leaflet)
install.packages("leaflet")
library(leaflet)
library(leaflet)
version
getwd()
